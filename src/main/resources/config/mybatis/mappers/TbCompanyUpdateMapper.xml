<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silita.biaodaa.dao.TbCompanyUpdateMapper">
    <resultMap id="BaseResultMap" type="com.silita.biaodaa.model.TbCompanyUpdate">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="pkid" property="pkid" jdbcType="INTEGER"/>
        <result column="com_id" property="comId" jdbcType="VARCHAR"/>
        <result column="com_name" property="comName" jdbcType="VARCHAR"/>
        <result column="user_id" property="userId" jdbcType="VARCHAR"/>
        <result column="is_updated" property="isUpdated" jdbcType="INTEGER"/>
        <result column="created" property="created" jdbcType="TIMESTAMP"/>
        <result column="updated" property="updated" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!--查询待更新的企业信息-->
    <select id="queryCompanyUpdated" parameterType="java.util.Map" resultMap="BaseResultMap">
      SELECT
        *
      FROM
        tb_company_update t
      WHERE t.`is_updated` = #{isUpdated}
      GROUP BY t.com_id
      ORDER BY t.`created` ASC
      LIMIT #{limit}
  </select>

    <!--查询企业的更新状态-->
    <select id="queryCompanyUpdatedState" parameterType="java.util.Map" resultType="java.lang.Integer">
        select
          count(1)
        from
          tb_company_update t
        where t.`com_id` = #{comId}
          and (
            t.`is_updated` = 0
            or t.`is_updated` = 1
          )
    </select>

    <!--修改-->
    <update id="updated" parameterType="com.silita.biaodaa.model.TbCompanyUpdate">
        UPDATE
          tb_company_update
        SET
          `is_updated` = #{isUpdated},
          `updated` = now()
        WHERE `pkid` = #{pkid}
    </update>

    <!--删除记录-->
    <delete id="deleteCompanyUpdated" parameterType="java.lang.String">
        DELETE
        FROM
          `tb_company_update`
        WHERE `com_id` = #{comId}
    </delete>

    <!--添加-->
    <insert id="insert" parameterType="com.silita.biaodaa.model.TbCompanyUpdate">
        insert into `tb_company_update`(
        <if test="comId != null and comId != ''">
            `com_id`,
        </if>
        <if test="comName != null and comName != ''">
            `com_name`,
        </if>
        <if test="userId != null and userId != ''">
            `user_id`,
        </if>
        <if test="isUpdated != null">
            `is_updated`,
        </if>
        `created`
        )
        values
        (
        <if test="comId != null and comId != ''">
            #{comId},
        </if>
        <if test="comName != null and comName != ''">
            #{comName},
        </if>
        <if test="userId != null and userId != ''">
            #{userId},
        </if>
        <if test="isUpdated != null">
            #{isUpdated},
        </if>
        now()
        )
    </insert>
</mapper>