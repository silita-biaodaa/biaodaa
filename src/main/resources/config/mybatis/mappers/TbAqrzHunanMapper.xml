<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silita.biaodaa.dao.TbAqrzHunanMapper">
    <resultMap id="BaseResultMap" type="com.silita.biaodaa.model.TbAqrzHunan">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="pkid" property="pkid" jdbcType="INTEGER"/>
        <result column="com_id" property="comId" jdbcType="VARCHAR"/>
        <result column="grade" property="grade" jdbcType="VARCHAR"/>
        <result column="region" property="region" jdbcType="VARCHAR"/>
        <result column="issued" property="issued" jdbcType="VARCHAR"/>
        <result column="valided" property="valided" jdbcType="VARCHAR"/>
        <result column="updated" property="updated" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!--查询安全认证-->
    <select id="queryAqrz" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
            t.`grade`,
            t.`issued`,
            t.`region`,
            t1.`score`
        FROM
        tb_aqrz_hunan t
        JOIN tb_awards t1
        ON t.`grade` = t1.`award_name`
        AND t1.`award_type` = 'sjaqrz'
        WHERE t.`com_id` = #{comId}
        AND DATE(t.`valided`) &gt;= NOW()
        ORDER BY t1.`score` DESC
        LIMIT 1
    </select>

    <!--查询企业的安全认证-->
    <select id="queryCompanyAqrz" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
          t.`issued`,
          t.`valided`,
          CONCAT(
            '安全认证--',
            t.`grade`,
            '（',
            t.`region`,
            '）'
          ) AS awardName
        FROM
          tb_aqrz_hunan t
        WHERE t.`com_id` = #{comId}
        ORDER BY t.`updated` DESC
        LIMIT 1
    </select>
</mapper>